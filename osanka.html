<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ß–µ–∫-–ª–∏—Å—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: –æ—Å–∞–Ω–∫–∞ ¬∑ —Å—É—Ç—É–ª–æ—Å—Ç—å ¬∑ –ø–æ–ø–µ—Ä–µ—á–Ω–∞—è</title>

  <script>
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É –¥–æ —Ä–µ–Ω–¥–µ—Ä–∞, —á—Ç–æ–±—ã –Ω–µ –º–µ–ª—å–∫–∞–ª–∞ —Ç—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è
    (function() {
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "light") {
        document.documentElement.classList.add("light-theme");
      }
    })();
  </script>

  <style>
:root {
  /* === –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) === */
  --bg-main: linear-gradient(135deg,#333 0%,#1c1c1c 100%);
  --bg-sidebar: #1b1b1b;
  --bg-container: #212121;
  --bg-section: #282828;
  --bg-card: #333;
  --bg-input: #333;
  --bg-table: #444;
  --bg-table-header: #555;

  --text-main: #ddd;
  --text-secondary: #aaa;
  --text-title: #f0f0f0;
  --text-contrast: #fff;

  --border-color: #666;
  --header-bg: linear-gradient(135deg,#444 0%,#333 100%);

  --btn-bg: linear-gradient(135deg,#7f8c8d 0%,#5f6a6a 100%);
  --btn-text: #fff;

  --error-bg: #a60000;
  --error-text: #fff;
}

body.light-theme {
  /* === –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ === */
  --bg-main: linear-gradient(135deg,#f2f2f2 0%,#e8e8e8 100%);
  --bg-sidebar: #eaeaea;
  --bg-container: #fff;
  --bg-section: #f9f9f9;
  --bg-card: #f5f5f5;
  --bg-input: #fff;
  --bg-table: #f5f5f5;
  --bg-table-header: #ddd;

  --text-main: #222;
  --text-secondary: #444;
  --text-title: #111;
  --text-contrast: #000;

  --border-color: #bbb;
  --header-bg: linear-gradient(135deg,#ddd 0%,#bbb 100%);

  --btn-bg: linear-gradient(135deg,#bbb 0%,#999 100%);
  --btn-text: #222;

  --error-bg: #ff5555;
  --error-text: #fff;
}

/* === –û–±—â–∏–π —Å—Ç–∏–ª—å === */
* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-main);
  min-height:100vh; padding:20px;
  display:flex;
  color: var(--text-main);
}

/* === –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é === */
.sidebar {
  width:220px;
  background: var(--bg-sidebar);
  border-radius:10px;
  box-shadow:0 0 15px rgba(0,0,0,0.5);
  padding:15px;
  margin-right:20px;
  height:fit-content;
  position:sticky;
  top:20px;
}
.sidebar h2 {
  font-size:1.3em;
  margin-bottom:10px;
  color: var(--text-title);
  text-align:center;
}
.sidebar ul { list-style:none; }
.sidebar li { margin:8px 0; position:relative; }
.sidebar a {
  display:block;
  padding:10px 12px;
  text-decoration:none;
  color: var(--text-main);
  border-radius:8px;
  transition:background .3s, color .3s;
}
.sidebar a:hover {
  background: var(--bg-card);
  color: var(--text-contrast);
}
.dropdown > a::after {
  content:"‚ñº";
  float:right;
  font-size:0.8em;
  transition:transform .3s;
}
.dropdown.open > a::after { transform:rotate(-180deg); }
.dropdown ul { display:none; margin-left:10px; }
.dropdown.open ul { display:block; }
.dropdown ul a {
  font-size:0.9em;
  background: var(--bg-section);
}

/* === –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ === */
.app {
  flex:1;
  max-width:1200px;
  background: var(--bg-container);
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.7);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

header {
  background: var(--header-bg);
  color: var(--text-title);
  padding:30px;
  text-align:center;
  border-bottom:2px solid var(--border-color);
  position:relative;
}
header h1 {
  font-size:2.2em;
  margin:0;
}

.content {
  padding:30px;
  background: var(--bg-section);
  flex:1;
}
.controls {
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
  margin-bottom:20px;
}
button {
  border:none;
  padding:14px 24px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  font-size:16px;
  transition:transform .2s, background .3s;
}
#generate {
  background: var(--btn-bg);
  color: var(--btn-text);
}
#save {
  background: var(--bg-card);
  color: var(--text-main);
  border:2px solid var(--border-color);
}
#clear {
  background: linear-gradient(135deg,#a60000,#6b0000);
  color:white;
}
button:hover { transform:translateY(-2px); }
.hint {
  color: var(--text-secondary);
  font-size:14px;
  text-align:center;
  margin-bottom:20px;
}

/* === –°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π === */
.exercise-list {
  list-style:none;
  padding:0;
  margin:0;
  display:grid;
  gap:20px;
}
.exercise-list li {
  background: var(--bg-card);
  border-radius:10px;
  padding:18px;
  box-shadow:0 2px 10px rgba(0,0,0,0.5);
  display:grid;
  gap:10px;
}
.title {
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:bold;
  font-size:1.1em;
  color: var(--text-title);
}
.badge {
  font-size:12px;
  padding:4px 10px;
  border-radius:999px;
  background: var(--bg-table-header);
  color: var(--text-main);
}
label.exercise {
  display:grid;
  grid-template-columns:24px 1fr;
  gap:12px;
  cursor:pointer;
}
input[type="checkbox"] {
  width:20px; height:20px; margin-top:2px;
  accent-color:#34d399;
}
.desc { color: var(--text-main); font-size:14px; }
.meta { color: var(--text-secondary); font-size:12px; }

footer {
  padding:20px;
  background: var(--bg-section);
  border-top:2px solid var(--border-color);
  display:flex;
  align-items:center;
  justify-content: space-between;
  font-size:13px;
  color: var(--text-secondary);
  gap:12px;
  flex-wrap: nowrap;
}

/* === –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤ —Ñ—É—Ç–µ—Ä–µ === */
.progress-container {
  flex: 1;
  height: 12px;
  background: var(--bg-card);
  border-radius: 6px;
  overflow: hidden;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
  min-width: 120px;
}
#progress-bar {
  height: 100%;
  width: 0%;
  border-radius: 6px 0 0 6px;
  transition: width 0.4s ease, background 0.4s ease;
}

/* === –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã === */
.theme-toggle {
  position: fixed;
  left: 20px; bottom: 20px;
  background: #444;
  color: white;
  border: none;
  border-radius: 50%;
  width: 50px; height: 50px;
  cursor: pointer;
  font-size: 1.4em;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 8px rgba(0,0,0,0.4);
  transition: background .3s, transform .2s;
  z-index: 1000;
}
body.light-theme .theme-toggle {
  background: #ddd;
  color: #222;
}
.theme-toggle:hover { transform: translateY(-2px); }

@media (max-width: 768px) {
  body {
    flex-direction: column;
    padding: 10px;
  }
  .sidebar {
    width: 100%;
    margin: 0 0 15px 0;
    position: relative;
    top: auto;
  }
  .app {
    margin: 0 8px; 
    overflow: visible;     
  }
  .content {
    flex: 0 1 auto;       
  }
  footer {
    flex-direction: column;
    align-items: stretch;
    text-align: center;
  }
  .progress-container {
    width: 100%;
    min-width: auto;
    margin: 6px 0;
  }
}
  </style>
</head>
<body>
  <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
  <div class="sidebar" aria-hidden="false">
    <h2>–ú–µ–Ω—é</h2>
    <ul>
      <li><a href='/'>üè† –ì–ª–∞–≤–Ω–∞—è</a></li>
      <li class="dropdown">
        <a href="#">üìÇ –†–∞–∑–¥–µ–ª—ã</a>
        <ul>
          <li><a href='/gum'>–ú–æ—ë —Ç–µ–ª–æ - –∂–µ–ª–µ–∑–æ</a></li>
          <li><a href='/osanka'>–ü–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫ - —Ç–∏—Ç–∞–Ω</a></li>
        </ul>
      </li>
      <li><a href='/about'>‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
    </ul>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <div class="app" role="application" aria-label="–ß–µ–∫-–ª–∏—Å—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π">
    <header>
      <h1>üìã –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h1>
    </header>

    <div class="content">
      <div class="controls">
        <button id="generate">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ</button>
        <button id="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <button id="clear" title="–û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>

      <p class="hint">–ö–∞–∂–¥—ã–π —Ä–∞–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è <strong>1 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–∞ –æ—Å–∞–Ω–∫—É</strong>, <strong>1 ‚Äî –ø—Ä–æ—Ç–∏–≤ —Å—É—Ç—É–ª–æ—Å—Ç–∏</strong> –∏ <strong>1 ‚Äî –¥–ª—è –ø–æ–ø–µ—Ä–µ—á–Ω–æ–π –º—ã—à—Ü—ã –∂–∏–≤–æ—Ç–∞</strong>.</p>

      <ul id="list" class="exercise-list" aria-live="polite" aria-atomic="true"></ul>
    </div>

    <footer>
      <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:</span>

      <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –º–µ–∂–¥—É –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
      <div class="progress-container" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="progress-container">
        <div id="progress-bar" aria-hidden="true"></div>
      </div>

      <span id="progress">0 / 3 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
    </footer>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>

  <script>
    const STORAGE_KEY = 'coreChecklistV1';
    const POOLS = {
      posture: [
        { name: '–°—Ç–µ–Ω–∞-–∞–Ω–≥–µ–ª—ã', desc: '–°–ø–∏–Ω–æ–π –∫ —Å—Ç–µ–Ω–µ, —Ä—É–∫–∏ –æ—Ç ¬´W¬ª –∫ ¬´Y¬ª, –ø–æ—è—Å–Ω–∏—Ü–∞ –ø—Ä–∏–∂–∞—Ç–∞.', meta: '2√ó8‚Äì12 –º–µ–¥–ª–µ–Ω–Ω–æ' },
        { name: '–ü–æ–¥–±–æ—Ä–æ–¥–æ–∫ –∫ –≥–æ—Ä–ª—É', desc: '–í—Ç—è–≥–∏–≤–∞–π –ø–æ–¥–±–æ—Ä–æ–¥–æ–∫ –Ω–∞–∑–∞–¥, –¥–µ—Ä–∂–∏ 2‚Äì3 —Å–µ–∫.', meta: '2√ó10‚Äì12' },
        { name: '–£–¥–ª–∏–Ω–µ–Ω–∏–µ –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ —Å–∏–¥—è', desc: '–°–∏–¥—è, –≤—ã—Ç—è–≥–∏–≤–∞–π—Å—è –º–∞–∫—É—à–∫–æ–π –≤–≤–µ—Ä—Ö.', meta: '2√ó60 —Å–µ–∫' },
        { name: '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ¬´–°—Ç–µ–Ω–∞¬ª', desc: '–ü—Ä–∏–∂–º–∏ —Å–ø–∏–Ω—É –∫ —Å—Ç–µ–Ω–µ, –∑–∞—Ç–µ–º –º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–¥–Ω–∏–º–∞–π-–æ–ø—É—Å–∫–∞–π —Ä—É–∫–∏ –≤–¥–æ–ª—å –Ω–µ—ë.', meta: '1√ó1 –º–∏–Ω' },
        { name: '–ö–æ—à–∫–∞‚Äì—Å–æ–±–∞–∫–∞', desc: '–ù–∞ —á–µ—Ç–≤–µ—Ä–µ–Ω—å–∫–∞—Ö –ø—Ä–æ–≥–∏–±–∞–π –∏ –æ–∫—Ä—É–≥–ª—è–π —Å–ø–∏–Ω—É, –¥—ã—à–∏ –≥–ª—É–±–æ–∫–æ.', meta: '2√ó10 –¥–≤–∏–∂–µ–Ω–∏–π' },
        { name: '–ü–æ–∑–∞ —Ä–µ–±—ë–Ω–∫–∞', desc: '–°—è–¥—å –Ω–∞ –∫–æ–ª–µ–Ω–∏, –ª—è–≥ –∂–∏–≤–æ—Ç–æ–º, –≤—ã—Ç—è–≥–∏–≤–∞–π —Ä—É–∫–∏, —Ä–∞—Å—Å–ª–∞–±—å —Å–ø–∏–Ω—É.', meta: '1‚Äì2 –º–∏–Ω' },
      ],
      antiSlouch: [
        { name: '–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –ª–æ–ø–∞—Ç–æ–∫', desc: '–°–≤–æ–¥–∏ –ª–æ–ø–∞—Ç–∫–∏ –≤–Ω–∏–∑ –∏ –≤–Ω—É—Ç—Ä—å.', meta: '3√ó12‚Äì15' },
        { name: 'YTW –ª—ë–∂–∞', desc: '–ü–æ–¥–Ω–∏–º–∏ —Ä—É–∫–∏ –≤ —Ñ–æ—Ä–º—ã Y, T, W.', meta: '2√ó6 –∫–∞–∂–¥–æ–≥–æ' },
        { name: '–†–∞—Å—Ç—è–∂–∫–∞ –∑–∞–¥–Ω–µ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –±–µ–¥—Ä–∞ –ª—ë–∂–∞', desc: '–õ—è–≥, –ø–æ–¥—Ç—è–Ω–∏ –æ–¥–Ω—É –Ω–æ–≥—É –∫ —Å–µ–±–µ, –≤—ã–ø—Ä—è–º–∏ –µ—ë.', meta: '2‚Äì3√ó20‚Äì30 —Å–µ–∫/–Ω–æ–≥–∞' },
        { name: '–ü—Ä–æ–≥–∏–± –≤ —Å–ø–∏–Ω–µ —Å—Ç–æ—è', desc: '–í—Å—Ç–∞–Ω—å –ø—Ä—è–º–æ, —Ä—É–∫–∏ –Ω–∞ —Ç–∞–ª–∏–∏, –ø—Ä–æ–≥–Ω–∏—Å—å –Ω–∞–∑–∞–¥.', meta: '5√ó5 —Å–µ–∫' },
      ],
      transverse: [
        { name: '–í–∞–∫—É—É–º –∂–∏–≤–æ—Ç–∞', desc: '–í—ã–¥–æ—Ö ‚Üí –ø–æ–¥—Ç—è–Ω–∏ –∂–∏–≤–æ—Ç –≤–Ω—É—Ç—Ä—å –∏ –≤–≤–µ—Ä—Ö.', meta: '3√ó10‚Äì20 —Å–µ–∫' },
        { name: 'Dead Bug', desc: '–ü–æ—è—Å–Ω–∏—Ü–∞ –ø—Ä–∏–∂–∞—Ç–∞, –º–µ–¥–ª–µ–Ω–Ω–æ –æ–ø—É—Å–∫–∞–π —Ä—É–∫—É –∏ –Ω–æ–≥—É.', meta: '2√ó10/—Å—Ç–æ—Ä–æ–Ω–∞' },
        { name: '–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç–∏–∫', desc: '–õ—è–≥ –Ω–∞ —Å–ø–∏–Ω—É, –ø–æ–¥–Ω–∏–º–∏ —Ç–∞–∑, –Ω–∞–ø—Ä—è–≥–∏ –ø–æ–ø–µ—Ä–µ—á–Ω—É—é –º—ã—à—Ü—É.', meta: '3√ó8‚Äì10' },
        { name: '–ë–æ–∫–æ–≤–∞—è –ø–ª–∞–Ω–∫–∞', desc: '–£–¥–µ—Ä–∂–∏–≤–∞–π —Ç–µ–ª–æ –≤ –ø—Ä—è–º–æ–π –ª–∏–Ω–∏–∏, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –±–æ–∫–æ–≤–æ–π –ª–æ–∫–æ—Ç—å.', meta: '2√ó20‚Äì60 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω–∞' },
      ]
    };

    const listEl = document.getElementById('list');
    const progressEl = document.getElementById('progress');
    const progressBarEl = document.getElementById('progress-bar');
    const progressContainerEl = document.getElementById('progress-container');

    const randPick = (arr) => arr[Math.floor(Math.random() * arr.length)];

    function buildItem(ex, category, idx) {
      const li = document.createElement('li');

      const title = document.createElement('div');
      title.className = 'title';
      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.textContent = category === 'posture' ? '–û—Å–∞–Ω–∫–∞' : category === 'antiSlouch' ? '–ü—Ä–æ—Ç–∏–≤ —Å—É—Ç—É–ª–æ—Å—Ç–∏' : '–ü–æ–ø–µ—Ä–µ—á–Ω–∞—è';
      const span = document.createElement('span');
      span.textContent = ex.name;
      title.appendChild(badge);
      title.appendChild(span);

      const label = document.createElement('label');
      label.className = 'exercise';
      label.setAttribute('for', 'cb-' + idx);

      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.id = 'cb-' + idx;
      cb.setAttribute('aria-label', ex.name + ' ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ');
      cb.addEventListener('change', () => {
        saveProgress();
      });

      const descWrap = document.createElement('div');
      const desc = document.createElement('div');
      desc.className = 'desc';
      desc.textContent = ex.desc;
      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = ex.meta;

      descWrap.appendChild(desc);
      descWrap.appendChild(meta);
      label.appendChild(cb);
      label.appendChild(descWrap);

      li.appendChild(title);
      li.appendChild(label);
      return li;
    }

    function generateNew() {
      const selected = [
        randPick(POOLS.posture),
        randPick(POOLS.antiSlouch),
        randPick(POOLS.transverse)
      ];
      renderList(selected, [false, false, false]);
      persist({ items: selected, checks: [false, false, false] });
    }

    function renderList(items, checks = []) {
      listEl.innerHTML = '';
      items.forEach((ex, idx) => {
        const category = idx === 0 ? 'posture' : idx === 1 ? 'antiSlouch' : 'transverse';
        const el = buildItem(ex, category, idx);
        const cb = el.querySelector('input[type="checkbox"]');
        cb.checked = !!checks[idx];
        // –í–µ—à–∞–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Äî —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ buildItem
        listEl.appendChild(el);
      });
      updateProgress();
    }

    function updateProgress() {
      const boxes = listEl.querySelectorAll('input[type="checkbox"]');
      const done = Array.from(boxes).filter(b => b.checked).length;
      progressEl.textContent = `${done} / ${boxes.length} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ`;

      const percent = boxes.length ? Math.round((done / boxes.length) * 100) : 0;
      progressBarEl.style.width = percent + "%";
      progressContainerEl.setAttribute('aria-valuenow', percent);

      // –¶–≤–µ—Ç –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é: 0-1 –∫—Ä–∞—Å–Ω—ã–π, 2 ‚Äî –∂—ë–ª—Ç—ã–π, 3 ‚Äî –∑–µ–ª—ë–Ω—ã–π
      if (done === 0 || done === 1) {
        progressBarEl.style.background = "linear-gradient(135deg,#ef4444,#b91c1c)"; // –∫—Ä–∞—Å–Ω—ã–π
      } else if (done === 2) {
        progressBarEl.style.background = "linear-gradient(135deg,#f59e0b,#d97706)"; // –∂—ë–ª—Ç—ã–π
      } else if (done === 3) {
        progressBarEl.style.background = "linear-gradient(135deg,#34d399,#059669)"; // –∑–µ–ª—ë–Ω—ã–π
      } else {
        progressBarEl.style.background = "linear-gradient(135deg,#6b7280,#374151)"; // –∑–∞–ø–∞—Å–Ω–æ–π
      }
    }

    function getState() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || null; } catch { return null; }
    }

    function persist(state) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage:", e);
      }
    }

    function saveProgress() {
      const state = getState();
      // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ—Ç (–Ω–∞–ø—Ä. —Å–ø–∏—Å–æ–∫ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω) ‚Äî —Å–æ–∑–¥–∞–¥–∏–º –µ–≥–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
      let items = state?.items || Array.from(listEl.querySelectorAll('.title span')).map(s => ({ name: s.textContent }));
      const checks = Array.from(listEl.querySelectorAll('input[type="checkbox"]')).map(cb => cb.checked);
      persist({ items, checks });
      updateProgress();
    }

    // –ö–Ω–æ–ø–∫–∏
    document.getElementById('generate').addEventListener('click', () => {
      generateNew();
    });
    document.getElementById('save').addEventListener('click', () => {
      // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ items+checks (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ-—Ç–æ –ø–æ–º–µ–Ω—è–ª)
      const items = Array.from(listEl.querySelectorAll('.title span')).map((sp) => {
        return { name: sp.textContent };
      });
      const checks = Array.from(listEl.querySelectorAll('input[type="checkbox"]')).map(cb => cb.checked);
      persist({ items, checks });
      // –ö–æ—Ä–æ—Ç–∫–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ç–æ—Å—Ç)
      document.getElementById('save').textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì';
      setTimeout(()=> document.getElementById('save').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫', 1200);
    });
    document.getElementById('clear').addEventListener('click', () => {
      localStorage.removeItem(STORAGE_KEY);
      listEl.innerHTML = '';
      progressEl.textContent = '0 / 3 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ';
      progressBarEl.style.width = '0%';
      progressBarEl.style.background = "linear-gradient(135deg,#ef4444,#b91c1c)";
      progressContainerEl.setAttribute('aria-valuenow', 0);
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    (function init() {
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
      const saved = getState();
      if (saved?.items?.length === 3) {
        // –ü–æ–ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: –µ—Å–ª–∏ –≤ saved.items –µ—Å—Ç—å full info - –∏—Å–ø–æ–ª—å–∑—É–µ–º, –∏–Ω–∞—á–µ –≤–æ–∑—å–º—ë–º –∏–∑ POOLS –ø–æ –∏–º–µ–Ω–∏
        const itemsRestored = saved.items.map(it => {
          // –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –ø–æ—Ö–æ–∂ –Ω–∞ –ø–æ–ª–Ω—ã–π (name + desc), –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
          if (it.desc || it.meta) return it;
          // –∏–Ω–∞—á–µ –∏—â–µ–º –≤ –ø—É–ª–∞—Ö –ø–æ –∏–º–µ–Ω–∏
          for (const key of Object.keys(POOLS)) {
            const found = POOLS[key].find(p => p.name === it.name);
            if (found) return found;
          }
          // –∑–∞–ø–∞—Å–Ω–æ–π ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–º—è
          return { name: it.name || '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', desc: '', meta: '' };
        });
        renderList(itemsRestored, saved.checks || [false, false, false]);
      } else {
        generateNew();
      }

      // –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
      document.querySelectorAll(".dropdown > a").forEach(el=>{
        el.addEventListener("click",e=>{
          e.preventDefault();
          el.parentElement.classList.toggle("open");
        });
      });
    })();

    // –¢–µ–º–∞
    function toggleTheme() {
      document.body.classList.toggle("light-theme");
      const isLight = document.body.classList.contains("light-theme");
      localStorage.setItem("theme", isLight ? "light" : "dark");
      document.querySelector(".theme-toggle").textContent = isLight ? "‚òÄÔ∏è" : "üåô";
    }

    window.onload = function() {
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "light") {
        document.body.classList.add("light-theme");
        document.querySelector(".theme-toggle").textContent = "‚òÄÔ∏è";
      } else {
        document.querySelector(".theme-toggle").textContent = "üåô";
      }
    };
  </script>
</body>
</html>



